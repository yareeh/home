if [ -f /etc/zshrc ]; then
	source /etc/zshrc
fi

# OS detection
if [[ "$OSTYPE" == "darwin"* ]]; then
    IS_MAC=true
else
    IS_MAC=false
fi

# oh-my-zsh
export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME="robbyrussell"
plugins=(git)
source $ZSH/oh-my-zsh.sh
unsetopt share_history

# Antigen (conditional)
if $IS_MAC; then
    [[ -f "$(brew --prefix)/share/antigen/antigen.zsh" ]] && source "$(brew --prefix)/share/antigen/antigen.zsh"
else
    [[ -f /usr/share/zsh-antigen/antigen.zsh ]] && source /usr/share/zsh-antigen/antigen.zsh
    [[ -f ~/.antigen/antigen.zsh ]] && source ~/.antigen/antigen.zsh
fi
if command -v antigen >/dev/null; then
    antigen bundle lukechilds/zsh-nvm
    antigen apply
fi

alias grep='grep --color=auto'
alias ssh='LANG=en ssh'

# Emacs Client
if $IS_MAC; then
    alias ec='/Applications/Emacs.app/Contents/MacOS/bin/emacsclient -c'
else
    alias ec='emacsclient -c'
fi

# edit tmp file
function tempcode() {
    file=$(mktemp -t temp).$1
    if $IS_MAC; then
        pbpaste >$file
    else
        xclip -selection clipboard -o >$file
    fi
    code $file
}
alias tempjson='tempcode json'

alias priva-git='git config user.email "jari+git@iki.fi"; git config sendemail.from "jari+git@iki.fi"'

# Yubikey oath
if $IS_MAC; then
    alias oath='ykman oath code -s $@ | pbcopy'
else
    alias oath='ykman oath code -s $@ | xclip -selection clipboard'
fi

alias depversion="~/git/home/depversion.py"

function gi() { curl -sLw n https://www.toptal.com/developers/gitignore/api/$@ ;}

# Android Studio
if $IS_MAC; then
    function astudio() {
        (/Applications/Android\ Studio.app/Contents/MacOS/studio . >/dev/null 2>&1 &)
    }
else
    function astudio() {
        (android-studio . >/dev/null 2>&1 &)
    }
fi

if command -v mise >/dev/null; then
    eval "$(mise activate zsh)"
    eval "$(mise hook-env -s zsh)"
fi

command -v direnv >/dev/null && eval "$(direnv hook zsh)"
export PATH="$HOME/.local/bin:$PATH"

# Python path (macOS only)
if $IS_MAC; then
    export PATH="$PATH:$HOME/Library/Python/3.9/bin"
fi

alias orion_rdp_tunnel="az network bastion tunnel \
--subscription '44592d61-1dd5-4f88-9b9a-de0ac0463e5b' \
--name 'bast-or-prd-we-001' \
--resource-group 'rg-or-bastion-prd-we-001' \
--target-resource-id '/subscriptions/5a950a74-fc51-459d-ae52-61c3b80dc059/resourceGroups/rg-rhea-tools-dev-we-001/providers/Microsoft.Compute/virtualMachines/lazwerheadevt01' \
--port 8300 \
--resource-port 3389"

alias orion_ssh_tunnel="az network bastion tunnel \
--subscription '44592d61-1dd5-4f88-9b9a-de0ac0463e5b' \
--name 'bast-or-prd-we-001' \
--resource-group 'rg-or-bastion-prd-we-001' \
--target-resource-id '/subscriptions/5a950a74-fc51-459d-ae52-61c3b80dc059/resourceGroups/rg-rhea-tools-dev-we-001/providers/Microsoft.Compute/virtualMachines/lazwerheadevt01' \
--port 8290 \
--resource-port 22"

alias orion_ssh_forwards="ssh -N -p 8290 \
-L 8291:aif-rhea-dev-sc-001.openai.azure.com:443 \
-L 8292:strheabotdevwe001.blob.core.windows.net:443 \
-L 8293:strheabotdevwe001.queue.core.windows.net:443 \
-L 8294:strheascraperdevwe001.blob.core.windows.net:443 \
-L 8295:strheascraperdevwe001.queue.core.windows.net:443 \
-L 8296:srch-rhea-dev-we-001.search.windows.net:443 \
lazwerheadevt01"

alias largest_dot_dirs='du -sh ~/.??* 2>/dev/null | sort -h'
